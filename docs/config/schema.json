{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "PairOfCleats configuration",
  "type": "object",
  "additionalProperties": false,
  "properties": {
    "cache": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "root": { "type": "string" }
      }
    },
    "quality": {
      "type": "string",
      "enum": ["auto", "fast", "balanced", "max"]
    },
    "threads": {
      "type": "number"
    },
    "runtime": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "uvThreadpoolSize": { "type": "number" },
        "maxOldSpaceMb": { "type": "number" },
        "nodeOptions": { "type": "string" },
        "ioOversubscribe": { "type": "boolean" }
      }
    },
    "tooling": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "dir": { "type": "string" },
        "autoInstallOnDetect": { "type": "boolean" },
        "autoEnableOnDetect": { "type": "boolean" },
        "installScope": { "type": "string" },
        "allowGlobalFallback": { "type": "boolean" },
        "strict": { "type": "boolean" },
        "timeoutMs": { "type": "number" },
        "maxRetries": { "type": "number" },
        "circuitBreakerThreshold": { "type": "number" },
        "logDir": { "type": "string" },
        "enabledTools": {
          "anyOf": [
            { "type": "string" },
            { "type": "array", "items": { "type": "string" } }
          ]
        },
        "disabledTools": {
          "anyOf": [
            { "type": "string" },
            { "type": "array", "items": { "type": "string" } }
          ]
        },
        "providerOrder": {
          "anyOf": [
            { "type": "string" },
            { "type": "array", "items": { "type": "string" } }
          ]
        },
        "vfs": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "coalesceSegments": { "type": "boolean" },
            "hashRouting": { "type": "boolean" },
            "strict": { "type": "boolean" },
            "maxVirtualFileBytes": { "type": "number" },
            "tokenMode": { "type": "string" },
            "ioBatching": {
              "type": "object",
              "additionalProperties": false,
              "properties": {
                "enabled": { "type": "boolean" },
                "maxInflight": { "type": "number" },
                "maxQueueEntries": { "type": "number" },
                "maxBatchBytes": { "type": "number" },
                "flushIntervalMs": { "type": "number" },
                "writeMode": { "type": "string", "enum": ["atomic", "direct"] }
              }
            },
            "coldStartCache": {
              "type": "object",
              "additionalProperties": false,
              "properties": {
                "enabled": { "type": "boolean" },
                "maxBytes": { "type": "number" },
                "maxAgeDays": { "type": "number" },
                "cacheRoot": { "type": "string" }
              }
            }
          }
        },
        "lsp": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "enabled": { "type": "boolean" },
            "servers": {
              "type": "array",
              "items": {
                "type": "object",
                "additionalProperties": true,
                "properties": {
                  "id": { "type": "string" },
                  "label": { "type": "string" },
                  "cmd": { "type": "string" },
                  "args": {
                    "anyOf": [
                      { "type": "string" },
                      { "type": "array", "items": { "type": "string" } }
                    ]
                  },
                  "languages": {
                    "anyOf": [
                      { "type": "string" },
                      { "type": "array", "items": { "type": "string" } }
                    ]
                  },
                  "uriScheme": { "type": "string", "enum": ["file", "poc-vfs"] },
                  "timeoutMs": { "type": "number" },
                  "retries": { "type": "number" },
                  "priority": { "type": "number" },
                  "version": { "type": "string" }
                }
              }
            }
          }
        },
        "cache": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "enabled": { "type": "boolean" },
            "dir": { "type": "string" }
          }
        },
        "typescript": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "enabled": { "type": "boolean" },
            "resolveOrder": {
              "anyOf": [
                { "type": "string" },
                { "type": "array", "items": { "type": "string" } }
              ]
            },
            "useTsconfig": { "type": "boolean" },
            "tsconfigPath": { "type": "string" },
            "allowJs": { "type": "boolean" },
            "checkJs": { "type": "boolean" },
            "includeJsx": { "type": "boolean" },
            "maxFiles": { "type": "number" },
            "maxFileBytes": { "type": "number" },
            "maxProgramFiles": { "type": "number" }
          }
        },
        "clangd": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "requireCompilationDatabase": { "type": "boolean" },
            "compileCommandsDir": { "type": "string" }
          }
        },
        "pyright": {
          "type": "object",
          "additionalProperties": true
        },
        "sourcekit": {
          "type": "object",
          "additionalProperties": true
        }
      }
    },
    "mcp": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "mode": {
          "type": "string",
          "enum": ["legacy", "sdk", "auto"],
          "description": "MCP server mode; sdk requires @modelcontextprotocol/sdk capability."
        },
        "queueMax": { "type": "number" },
        "maxBufferBytes": { "type": "number" },
        "toolTimeoutMs": { "type": "number" },
        "toolTimeouts": {
          "type": "object",
          "additionalProperties": { "type": "number" }
        }
      }
    },
    "indexing": {
      "type": "object",
      "additionalProperties": true,
      "properties": {
        "concurrency": { "type": "number" },
        "importConcurrency": { "type": "number" },
        "ioConcurrencyCap": { "type": "number" },
        "maxFileBytes": { "type": "number" },
        "maxFileLines": { "type": "number" },
        "artifacts": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "mode": { "type": "string" },
            "chunkMetaFormat": {
              "type": "string",
              "enum": ["auto", "json", "jsonl", "columnar"],
              "description": "Controls chunk_meta output format. auto chooses json/jsonl based on size; columnar forces columnar output."
            },
            "chunkMetaJsonlThreshold": { "type": "number" },
            "chunkMetaShardSize": { "type": "number" },
            "symbolArtifactsFormat": {
              "type": "string",
              "enum": ["auto", "jsonl", "jsonl-sharded", "columnar"],
              "description": "Controls symbol_occurrences/symbol_edges output. columnar forces columnar; other values use JSONL/sharded based on size."
            },
            "tokenPostingsFormat": { "type": "string" },
            "tokenPostingsShardSize": { "type": "number" },
            "tokenPostingsShardThreshold": { "type": "number" }
          }
        },
        "postings": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "enablePhraseNgrams": { "type": "boolean" },
            "enableChargrams": { "type": "boolean" },
            "phraseMinN": { "type": "number" },
            "phraseMaxN": { "type": "number" },
            "phraseSource": { "type": "string" },
            "chargramMinN": { "type": "number" },
            "chargramMaxN": { "type": "number" },
            "chargramMaxTokenLength": {
              "anyOf": [
                { "type": "number" },
                { "type": "boolean" },
                { "type": "null" }
              ]
            },
            "chargramSpillMaxUnique": { "type": "number" },
            "chargramMaxDf": {
              "type": "number",
              "minimum": 0,
              "description": "Maximum document frequency for chargram postings (0 disables the cap)."
            },
            "chargramSource": { "type": "string" },
            "fielded": { "type": "boolean" },
            "tokenClassification": {
              "anyOf": [
                { "type": "boolean" },
                {
                  "type": "object",
                  "additionalProperties": false,
                  "properties": {
                    "enabled": { "type": "boolean" }
                  }
                }
              ]
            }
          }
        },
        "scm": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "provider": { "type": "string", "enum": ["auto", "git", "jj", "none"] },
            "timeoutMs": { "type": "number" },
            "maxConcurrentProcesses": { "type": "number" },
            "churnWindowCommits": { "type": "number" },
            "annotate": {
              "type": "object",
              "additionalProperties": false,
              "properties": {
                "enabled": { "type": "boolean" },
                "maxFileSizeBytes": { "type": "number" },
                "timeoutMs": { "type": "number" }
              }
            },
            "jj": {
              "type": "object",
              "additionalProperties": false,
              "properties": {
                "snapshotWorkingCopy": { "type": "boolean" }
              }
            }
          }
        },
        "fileCaps": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "default": {
              "type": "object",
              "additionalProperties": false,
              "properties": {
                "maxBytes": { "type": "number" },
                "maxLines": { "type": "number" }
              }
            },
            "byMode": {
              "type": "object",
              "additionalProperties": false,
              "properties": {
                "code": {
                  "type": "object",
                  "additionalProperties": false,
                  "properties": {
                    "maxBytes": { "type": "number" },
                    "maxLines": { "type": "number" }
                  }
                },
                "prose": {
                  "type": "object",
                  "additionalProperties": false,
                  "properties": {
                    "maxBytes": { "type": "number" },
                    "maxLines": { "type": "number" }
                  }
                },
                "extracted-prose": {
                  "type": "object",
                  "additionalProperties": false,
                  "properties": {
                    "maxBytes": { "type": "number" },
                    "maxLines": { "type": "number" }
                  }
                },
                "records": {
                  "type": "object",
                  "additionalProperties": false,
                  "properties": {
                    "maxBytes": { "type": "number" },
                    "maxLines": { "type": "number" }
                  }
                }
              }
            },
            "byExt": {
              "type": "object",
              "additionalProperties": {
                "type": "object",
                "additionalProperties": false,
                "properties": {
                  "maxBytes": { "type": "number" },
                  "maxLines": { "type": "number" }
                }
              }
            },
            "byLanguage": {
              "type": "object",
              "additionalProperties": {
                "type": "object",
                "additionalProperties": false,
                "properties": {
                  "maxBytes": { "type": "number" },
                  "maxLines": { "type": "number" }
                }
              }
            }
          }
        },
        "graph": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "caps": {
              "type": "object",
              "additionalProperties": false,
              "properties": {
                "maxNodes": { "type": "number" },
                "maxEdges": { "type": "number" }
              }
            }
          }
        },
        "embeddings": {
          "type": "object",
          "additionalProperties": true,
          "properties": {
            "concurrency": { "type": "number" },
            "cache": {
              "type": "object",
              "additionalProperties": false,
              "properties": {
                "scope": { "type": "string", "enum": ["global", "repo", "local"] },
                "dir": { "type": "string" },
                "maxGb": { "type": "number" },
                "maxAgeDays": { "type": "number" }
              }
            },
            "provider": { "type": "string" },
            "onnx": {
              "type": "object",
              "additionalProperties": true,
              "properties": {
                "intraOpNumThreads": { "type": "number" },
                "interOpNumThreads": { "type": "number" }
              }
            }
          }
        },
        "riskInterprocedural": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "enabled": { "type": "boolean" },
            "summaryOnly": { "type": "boolean" },
            "strictness": { "type": "string", "enum": ["conservative", "argAware"] },
            "emitArtifacts": { "type": "string", "enum": ["none", "jsonl", "off"] },
            "sanitizerPolicy": { "type": "string", "enum": ["terminate", "weaken"] },
            "caps": {
              "type": "object",
              "additionalProperties": false,
              "properties": {
                "maxDepth": { "type": "number" },
                "maxPathsPerPair": { "type": "number" },
                "maxTotalFlows": { "type": "number" },
                "maxCallSitesPerEdge": { "type": "number" },
                "maxEdgeExpansions": { "type": "number" },
                "maxMs": { "type": ["number", "null"] }
              }
            }
          }
        }
      }
    },
    "retrieval": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "graph": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "caps": {
              "type": "object",
              "additionalProperties": false,
              "properties": {
                "maxDepth": { "type": "number" },
                "maxFanoutPerNode": { "type": "number" },
                "maxNodes": { "type": "number" },
                "maxEdges": { "type": "number" },
                "maxPaths": { "type": "number" },
                "maxCandidates": { "type": "number" },
                "maxWorkUnits": { "type": "number" },
                "maxWallClockMs": { "type": "number" }
              }
            }
          }
        },
        "graphRanking": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "enabled": { "type": "boolean" },
            "weights": { "type": "object", "additionalProperties": true },
            "maxGraphWorkUnits": { "type": "number" },
            "maxWallClockMs": { "type": "number" },
            "seedSelection": { "type": "string" },
            "seedK": { "type": "number" }
          }
        },
        "contextExpansion": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "enabled": { "type": "boolean" },
            "maxPerHit": { "type": "number" },
            "maxTotal": { "type": "number" },
            "includeCalls": { "type": "boolean" },
            "includeImports": { "type": "boolean" },
            "includeExports": { "type": "boolean" },
            "includeUsages": { "type": "boolean" },
            "maxWorkUnits": { "type": "number" },
            "maxWallClockMs": { "type": "number" },
            "maxCallEdges": { "type": "number" },
            "maxUsageEdges": { "type": "number" },
            "maxImportEdges": { "type": "number" },
            "maxExportEdges": { "type": "number" },
            "maxNameCandidates": { "type": "number" },
            "maxReasons": { "type": "number" },
            "respectFilters": { "type": "boolean" }
          }
        }
      }
    },
    "search": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "annDefault": { "type": "boolean" },
        "denseVectorMode": {
          "type": "string",
          "enum": ["merged", "code", "doc", "auto"]
        },
        "rrf": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "enabled": { "type": "boolean" },
            "k": { "type": "number" }
          }
        },
        "scoreBlend": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "enabled": { "type": "boolean" },
            "sparseWeight": { "type": "number" },
            "annWeight": { "type": "number" }
          }
        },
        "fieldWeights": {
          "type": "object",
          "additionalProperties": { "type": "number" }
        },
        "sqliteFtsWeights": {
          "anyOf": [
            { "type": "array", "items": { "type": "number" } },
            { "type": "object", "additionalProperties": true }
          ]
        },
        "maxCandidates": { "type": "number" },
        "sqliteAutoChunkThreshold": { "type": "number" },
        "sqliteAutoArtifactBytes": { "type": "number" }
      }
    }
  }
}
